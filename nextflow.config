#! /usr/bin/env nextflow

// C-WAP NextFlow configuration script


// Clear the work directory after successfull execution
// cleanup = true


manifest {
	homePage = 'https://github.com/CFSAN-Biostatistics/C-WAP'
    description = 'C-WAP: CFSAN Wastewater Analysis Pipeline'
	author = 'Tunc Kayikcioglu / FDA / CFSAN'
    mainScript = 'startWorkflow.nf'
}


params {
	referenceSequence = "$projectDir/covidRefSequences/wuhan.fa"
	variantDBfile = "$projectDir/covidRefSequences/varDefinitions.pkl"
	primerBedFile = "$projectDir/covidRefSequences/none.bed"
	in = "./"
	out = "./"
	partition = 'transition'
}


profiles {
    local_only {
        process.executor = 'local'
    }

    standard {
		// This block needs to be modified to customise for the available computational
		// resources
		executor {
			name = 'slurm'
			queueSize = 400
			queueStatInterval = '30 sec'
		}

		process {
			shell = ['/bin/bash','-e']
			
			executor = 'slurm'
			queue = params.partition
			time = '30 min'
			cpus = 2
			memory = '8 GB'
				
			// memory { 10GB*task.attempt }
			// time { 1.hour * task.attempt }
			// errorStrategy { task.exitStatus in 137..140 ? 'retry' : 'terminate' }
			errorStrategy = 'retry'
			maxRetries = 1

			// Disabled, as it increases computation time.
			// scratch = "ram-disk"
			// scratch = true
		}		
    }
}

